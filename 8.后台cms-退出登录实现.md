# 后台cms-退出登录实现
退出登录-触发时机:
- 1.用户主动点击`退出登录`
- 2.token过期 / 单点登录被顶下来,被动退出


用户退出时,需要实现:
- 1.清理当前用户信息缓存数据
- 2.清理掉权限相关配置
- 3.返回登录页



### 主动退出实现
```javascript
// `store/user.ts`
actions {
  /**
  * 注销登录
  *  1.清理access_token、refresh_token、userInfo
  *  2.清理权限相关配置
  *  最后强制跳转到登录页
  */
  async logout() {
    // acess
    this.token = ''
    CacheLocal.clear()
    // clear permission-config

    router.replace(CONST_ROUTER_LOGIN)
  }
}

```





### 被动退出-token失效（token安全策略）
- 客户端主动处理token失效
- 服务处理token失效,客户端更新token


客户端主动处理<前端主动介入token时效的处理>:
- 1.用户登录时,记录登录时间
- 2.配置'失效时长'
- 3.在接口调用时进行对比:
    + 如果 当前时间 - 登录时间 < 失效时长, 请求正常进行
    + 如果 当前时间 - 登录时间 >= 失效时长, 进行 退出登录 操作












### axios `config.headers.common['Authorization']` 设置token无法及时更新最新值? 自己挖坑跳
百度搜出来很多都是: config.headers.common['Authorization']
```bash
# 描述：
axios: 0.24.0

详细: 
1.用以前封装的axios文件,在请求头设置token是用的是:
config.headers.common['Authorization'] = `Bearer ${localStorage.getItem('token')}`
2.我在处理token刷新时,重新发送上次失败的请求,Authorization = 旧值,导致后续请求403


# 正确的用法应该是下面这样的
config.headers.Authorization = `Bearer ${localStorage.getItem('token')}`

```
