# 后台cms-国际化与动态换肤
- 国际化处理基于: vue-i18n
- 动态换肤




### 国际化处理(i18n / vue-i18n)
vue3 - vue-i18n@9.0+
安装依赖:`yarn add vue-i18n@next`

关键点:
- 1.第三方ui组件的语言切换
  - 官方提供的语言包-语言名: [element-plus-i18n](https://element-plus.gitee.io/zh-CN/guide/i18n.html#cdn-%E7%94%A8%E6%B3%95)
- 2.本地的语言切换

实现步骤:
- 1.封装i18n<创建数据源>
- 2.注册i18n组件
  - 在`main.ts`中`app.use(i18n)`即可
- 3.创建`localeStore`状态管理器
  - 封装自己i18n的语言切换功能 + 切换语言后的本地缓存
  - 提供数据信息对象给:'el-config-provider'用于初始化
- 4.封装`app-language`的语言切换组件
  + 用于提供触发语言切换的动作

ps:
- 1.因为本项目中element-plus的组件是`自动导入`的,
所以需要使用 'el-config-provider' 做顶级节点
- 2.原则: 在vue组件setup中使用`vue-i18n`的`useI18n()`,其他地方使用自定义的`@/store/locale`的`useLocalStore()`



#### 封装i18n<创建数据源>
```javascript
// `plugins/i18n`
import { createI18n } from 'vue-i18n'
// 导入ui库对应的语言包: element-plus需要用到的语言包
import zhcnLocale from 'element-plus/lib/locale/lang/zh-cn'
import enLocale from 'element-plus/lib/locale/lang/en'
// 自定义的语言包
import zhcnApp from './langs/zh-ch'
import enApp from './langs/en'
// 去内存中去语言缓存记录
import { CONST_APP_LANGUAGE_KEY } from '@/constant/system'
import { LocalStorageHelper } from '@/utils/storage'

/** 配置完整数据源 */
const messages = {
  [zhcnLocale.name]: {
    // name + el ->解决element的语言切换
    name: zhcnLocale.name,
    el: zhcnLocale.el,
    ...zhcnApp
  },
  [enLocale.name]: {
    // name + el ->解决element的语言切换
    name: enLocale.name,
    el: enLocale.el,
    ...enApp
  }
}

const i18n = createI18n({
  // 初始化时的语言，默认-默认
  locale: LocalStorageHelper.get(CONST_APP_LANGUAGE_KEY) || zhcnLocale.name,
  fallbackLocale: zhcnLocale.name,
  messages
})

export default i18n
```


#### 创建`localeStore`状态管理器
```javascript
...
import i18n from '@/plugins/i18n'

/** 系统语言状态控制管理器 */
const useLocaleStore = defineStore(EnumStoreID.localeStore, {
  state: () => {
    return {
      /** 当前系统语言名,默认:zh-cn */
      currentLang: LocalStorageHelper.get(CONST_APP_LANGUAGE_KEY) || 'zh-cn',
      /** 系统配置的语言包名<key,value> */
      langsRecord: readonly({
        'zh-cn': '中文',
        en: 'English'
      })
    }
  },
  getters: {
    /** 当前系统语言数据信息对象 */
    currentLocale(): any {
      return i18n.global.messages[i18n.global.locale]
    }
  },
  actions: {
    setLanguage(language: string): boolean {
      if (!Object.keys(this.langsRecord).includes(language)) return false

      // 更换i18的语言,本地缓存
      this.currentLang = language
      i18n.global.locale = language
      LocalStorageHelper.set(CONST_APP_LANGUAGE_KEY, language)

      return true
    },
    msg(key: string): string {
      return i18n.global.t(key)
    }
  }
})

export { useLocaleStore }
```


#### ElConfigProvider组件的使用:传入当前语言信息对象
```javascript
// App.vue 
<template>
  <el-config-provider :locale="localeStore.currentLocale">
    <router-view />
  </el-config-provider>
</template>

<script setup lang="ts">
import { ElConfigProvider } from 'element-plus'
import { useLocaleStore } from '@/store/locale'

const localeStore = useLocaleStore()
</script>
```


#### 封装`app-language`的语言切换组件
```javascript
<template>
  <el-dropdown
    class="app-language"
    :style="{ 'background-color': bgColor }"
    @command="onChangeLanguage"
    trigger="click"
  >
    <svg-icon :size="size" :icon="icon"></svg-icon>
    <template #dropdown>
      <el-dropdown-menu>
        <el-dropdown-item
          v-for="(value, key, i) in langsRecord"
          :key="key"
          :command="key"
          :divided="i > 0 ? true : false"
          :disabled="key === currentLang ? true : false"
        >
          {{ value }}
        </el-dropdown-item>
      </el-dropdown-menu>
    </template>
  </el-dropdown>
</template>

<script setup lang="ts">
import SvgIcon from '@/components/SvgIcon/index.vue'
import { useLocaleStore } from '@/store/locale'
import { ElMessage } from 'element-plus'
import { storeToRefs } from 'pinia'

defineProps({
  bgColor: {
    type: String,
    default: ''
  },
  size: {
    type: Number,
    default: 24
  },
  icon: {
    type: String,
    default: 'language'
  }
})

const localeStore = useLocaleStore()
// setLanguage, msg, lang, langsRecord 方法和某些属性不需要保存响应式
const { setLanguage, msg, langsRecord } = localeStore
// 需要保存响应式,使用-storeToRefs 或 直接 localeStore.currentLang 使用
const { currentLang } = storeToRefs(localeStore)

const onChangeLanguage = (language: string) => {
  setLanguage(language) && ElMessage.success(msg('language.switchSuccuss'))
}
</script>
```
